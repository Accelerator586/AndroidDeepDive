
**åˆ›å»ºä»¥ä¸‹å›¾è¡¨**ï¼ˆæˆ‘ç»™ä½ æ–‡å­—æè¿°ï¼Œä½ å¯ä»¥ç”¨ draw.io ç”»ï¼‰ï¼š

#### ğŸ“Š `architecture.png` - æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç”¨æˆ·ä»£ç ï¼ˆMainActivityï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ è°ƒç”¨æ¥å£æ–¹æ³•
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GitHubServiceï¼ˆæ¥å£å®šä¹‰ï¼‰                 â”‚
â”‚  @GET("users/{user}/repos")                 â”‚
â”‚  suspend fun listRepos(...)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Retrofit.create() åŠ¨æ€ä»£ç†             â”‚
â”‚  Proxy.newProxyInstance()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      InvocationHandler.invoke()             â”‚
â”‚  æ‹¦æˆªæ‰€æœ‰æ–¹æ³•è°ƒç”¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ServiceMethod                       â”‚
â”‚  è§£ææ³¨è§£ã€ç¼“å­˜æ–¹æ³•å…ƒæ•°æ®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CallAdapter  â”‚    â”‚  Converter   â”‚
â”‚ é€‚é…è¿”å›ç±»å‹   â”‚    â”‚  æ•°æ®è½¬æ¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   OkHttpCall   â”‚
        â”‚  æ„å»º Request   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     OkHttp     â”‚
        â”‚  æ‰§è¡Œç½‘ç»œè¯·æ±‚    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Response    â”‚
        â”‚   è¿”å›ç»™ç”¨æˆ·     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”„ `create-flow.png` - create() æµç¨‹
```
retrofit.create(GitHubService::class.java)
         â†“
validateServiceInterface(service)
éªŒè¯æ¥å£åˆæ³•æ€§
         â†“
Proxy.newProxyInstance(
    classLoader,
    interfaces,
    InvocationHandler { proxy, method, args ->
        loadServiceMethod(method).invoke(args)
    }
)
         â†“
è¿”å›ä»£ç†å¯¹è±¡
```

#### ğŸ“ `request-flow.png` - è¯·æ±‚æ‰§è¡Œæµç¨‹

```
service.listRepos("square")
         â†“
InvocationHandler.invoke()
         â†“
loadServiceMethod(method)
    â”œâ”€ æ£€æŸ¥ç¼“å­˜
    â”‚  â””â”€ æœ‰ç¼“å­˜ â†’ ç›´æ¥è¿”å›
    â””â”€ æ— ç¼“å­˜ â†’ è§£æ
         â†“
ServiceMethod.parseAnnotations()
    â”œâ”€ è§£ææ–¹æ³•æ³¨è§£ (@GET)
    â”œâ”€ è§£æå‚æ•°æ³¨è§£ (@Path)
    â””â”€ åˆ›å»º ServiceMethod
         â†“
ç¼“å­˜ ServiceMethod
         â†“
ServiceMethod.invoke(args)
         â†“
CallAdapter.adapt()
         â†“
åˆ›å»º OkHttpCall
         â†“
OkHttp.execute() / enqueue()
         â†“
Converter.convert()
         â†“
è¿”å›ç»“æœ
```

### 8.3 ä¿å­˜å›¾ç‰‡

å°†ç”»å¥½çš„å›¾ä¿å­˜ä¸º PNG æ ¼å¼ï¼Œæ”¾å…¥ `retrofit/diagrams/` ç›®å½•ï¼š
```
retrofit/diagrams/
â”œâ”€â”€ architecture.png
â”œâ”€â”€ create-flow.png
â”œâ”€â”€ request-flow.png
â””â”€â”€ source.drawio        # ğŸ‘ˆ ä¿å­˜å¯ç¼–è¾‘çš„æºæ–‡ä»¶
